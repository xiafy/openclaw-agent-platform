# Agent è‡ªåŠ¨åŒ–éƒ¨ç½²æ–¹æ¡ˆè®¾è®¡

> **ç‰ˆæœ¬**: v1.0
> **æ—¥æœŸ**: 2026-02-27
> **ç›®æ ‡**: L1/L2 éƒ¨ç½²å®Œå…¨è‡ªåŠ¨åŒ– (ä¸€é”®éƒ¨ç½²)
> **é¢„æœŸè€—æ—¶**: L1 (5 min) / L2 (30 min)

---

## ğŸ¯ è®¾è®¡ç›®æ ‡

### å½“å‰çŠ¶æ€ (æ‰‹åŠ¨)

| éƒ¨ç½²ç±»å‹ | å½“å‰è€—æ—¶ | æ‰‹åŠ¨æ­¥éª¤ | ç—›ç‚¹ |
|---------|---------|---------|------|
| **L1 (Profile)** | 30 min | 8 æ­¥ | é…ç½®é‡å¤ã€æ˜“å‡ºé”™ |
| **L2 (å®Œæ•´)** | 90 min | 9 æ­¥ | æƒé™é—®é¢˜ã€æ­¥éª¤ç¹ç |
| **L2 (æç®€)** | 10 min | 5 æ­¥ | éœ€æ‰‹åŠ¨æ‰§è¡Œå‘½ä»¤ |

### è‡ªåŠ¨åŒ–ç›®æ ‡

| éƒ¨ç½²ç±»å‹ | ç›®æ ‡è€—æ—¶ | è‡ªåŠ¨åŒ–ç‡ | ç”¨æˆ·äº¤äº’ |
|---------|---------|---------|---------|
| **L1 (Profile)** | 5 min | 95% | ä»…ç¡®è®¤ |
| **L2 (å®Œæ•´)** | 30 min | 90% | å¯†ç è¾“å…¥ |
| **L2 (æç®€)** | 3 min | 95% | ä»…ç¡®è®¤ |

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   éƒ¨ç½²è‡ªåŠ¨åŒ–ç³»ç»Ÿ                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  é…ç½®ç®¡ç†   â”‚    â”‚  éƒ¨ç½²å¼•æ“   â”‚    â”‚  éªŒè¯ç³»ç»Ÿ   â”‚ â”‚
â”‚  â”‚  Config     â”‚    â”‚  Deploy     â”‚    â”‚  Verify     â”‚ â”‚
â”‚  â”‚  Manager    â”‚    â”‚  Engine     â”‚    â”‚  System     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                  â”‚                  â”‚         â”‚
â”‚         â–¼                  â–¼                  â–¼         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  é…ç½®æ¨¡æ¿   â”‚    â”‚  L1/L2      â”‚    â”‚  å¥åº·æ£€æŸ¥   â”‚ â”‚
â”‚  â”‚  Templates  â”‚    â”‚  Scripts    â”‚    â”‚  Checks     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·ç•Œé¢å±‚                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  CLI (å‘½ä»¤è¡Œ)  â”‚  Web UI (å¯é€‰)  â”‚  API (å¯é€‰)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶

| ç»„ä»¶ | èŒè´£ | å®ç°æ–¹å¼ |
|------|------|---------|
| **é…ç½®ç®¡ç†** | é…ç½®ç”Ÿæˆã€éªŒè¯ã€æ¨¡æ¿åŒ– | Python + Jinja2 |
| **éƒ¨ç½²å¼•æ“** | æ‰§è¡Œéƒ¨ç½²æµç¨‹ã€é”™è¯¯å¤„ç† | Shell + Python |
| **éªŒè¯ç³»ç»Ÿ** | éƒ¨ç½²åéªŒè¯ã€å¥åº·æ£€æŸ¥ | Shell + HTTP è¯·æ±‚ |
| **å›æ»šæœºåˆ¶** | å¤±è´¥å›æ»šã€çŠ¶æ€æ¢å¤ | Shell è„šæœ¬ |

---

## ğŸ“ ç›®å½•ç»“æ„

```
~/Documents/claw-outputs/projects/agent-platform/
â”œâ”€â”€ deploy/                          # éƒ¨ç½²è‡ªåŠ¨åŒ–ç›®å½•
â”‚   â”œâ”€â”€ bin/                         # å¯æ‰§è¡Œè„šæœ¬
â”‚   â”‚   â”œâ”€â”€ deploy-agent             # ä¸»éƒ¨ç½²è„šæœ¬ (Python)
â”‚   â”‚   â”œâ”€â”€ verify-agent             # éªŒè¯è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ rollback-agent           # å›æ»šè„šæœ¬
â”‚   â”‚   â””â”€â”€ list-agents              # åˆ—å‡ºå·²éƒ¨ç½² Agent
â”‚   â”‚
â”‚   â”œâ”€â”€ lib/                         # åº“å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ config.py                # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ deploy_l1.py             # L1 éƒ¨ç½²é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ deploy_l2.py             # L2 éƒ¨ç½²é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ verify.py                # éªŒè¯é€»è¾‘
â”‚   â”‚   â””â”€â”€ utils.py                 # å·¥å…·å‡½æ•°
â”‚   â”‚
â”‚   â”œâ”€â”€ templates/                   # é…ç½®æ¨¡æ¿
â”‚   â”‚   â”œâ”€â”€ openclaw.json.j2         # openclaw é…ç½®æ¨¡æ¿
â”‚   â”‚   â”œâ”€â”€ launchdaemon.plist.j2    # LaunchDaemon æ¨¡æ¿
â”‚   â”‚   â”œâ”€â”€ IDENTITY.md.j2           # äººè®¾æ¨¡æ¿
â”‚   â”‚   â””â”€â”€ .env.j2                  # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”‚   â”‚
â”‚   â”œâ”€â”€ config/                      # é…ç½®æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ agents.yaml              # Agent é…ç½®æ¸…å•
â”‚   â”‚   â”œâ”€â”€ ports.yaml               # ç«¯å£åˆ†é…è¡¨
â”‚   â”‚   â””â”€â”€ defaults.yaml            # é»˜è®¤é…ç½®
â”‚   â”‚
â”‚   â””â”€â”€ logs/                        # éƒ¨ç½²æ—¥å¿—
â”‚       â””â”€â”€ deploy-YYYY-MM-DD.log
â”‚
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ deploy-automation-design.md  # æœ¬æ–‡ä»¶
â”‚   â”œâ”€â”€ deploy-automation-guide.md   # ä½¿ç”¨æŒ‡å—
â”‚   â””â”€â”€ deploy-automation-api.md     # API æ–‡æ¡£
â”‚
â””â”€â”€ scripts/                         # å¿«æ·è„šæœ¬ (å…¼å®¹æ—§ç‰ˆ)
    â”œâ”€â”€ deploy-l1-agent.sh           # L1 å¿«é€Ÿéƒ¨ç½²
    â””â”€â”€ deploy-l2-agent.sh           # L2 å¿«é€Ÿéƒ¨ç½²
```

---

## ğŸš€ éƒ¨ç½²æµç¨‹è®¾è®¡

### L1 éƒ¨ç½²æµç¨‹ (Profile æ¨¡å¼)

```
ç”¨æˆ·è¾“å…¥
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. è¾“å…¥ Agent ä¿¡æ¯ â”‚
â”‚    - åç§°        â”‚
â”‚    - è§’è‰²        â”‚
â”‚    - Bot Token   â”‚
â”‚    - ç«¯å£ (è‡ªåŠ¨)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. æ£€æŸ¥å‰ç½®æ¡ä»¶   â”‚
â”‚    - OpenClaw   â”‚
â”‚    - ç«¯å£å ç”¨    â”‚
â”‚    - Bot Token  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. åˆ›å»º Profile   â”‚
â”‚    - ç›®å½•ç»“æ„    â”‚
â”‚    - symlink    â”‚
â”‚    - é…ç½®æ–‡ä»¶    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. å¯åŠ¨ Gateway   â”‚
â”‚    - openclaw   â”‚
â”‚    - éªŒè¯ç«¯å£    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Telegram é…å¯¹  â”‚
â”‚    - è·å–é…å¯¹ç   â”‚
â”‚    - è‡ªåŠ¨æ‰¹å‡†    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. éªŒè¯æµ‹è¯•      â”‚
â”‚    - å·¥ä½œæµç¨‹    â”‚
â”‚    - æ¨¡å‹æµ‹è¯•    â”‚
â”‚    - åŠŸèƒ½æµ‹è¯•    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. ç”ŸæˆæŠ¥å‘Š      â”‚
â”‚    - éƒ¨ç½²çŠ¶æ€    â”‚
â”‚    - Bot ä¿¡æ¯    â”‚
â”‚    - è®¿é—®æ–¹å¼    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
âœ… éƒ¨ç½²å®Œæˆ (5 min)
```

### L2 éƒ¨ç½²æµç¨‹ (å®Œæ•´æ¨¡å¼)

```
ç”¨æˆ·è¾“å…¥
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. è¾“å…¥ Agent ä¿¡æ¯ â”‚
â”‚    - ç”¨æˆ·å      â”‚
â”‚    - æ˜¾ç¤ºåç§°    â”‚
â”‚    - Bot Token   â”‚
â”‚    - UID (è‡ªåŠ¨)  â”‚
â”‚    - å¯†ç         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. åˆ›å»º macOS ç”¨æˆ·  â”‚
â”‚    - dscl å‘½ä»¤   â”‚
â”‚    - è®¾ç½®å¯†ç     â”‚
â”‚    - åˆ›å»ºå®¶ç›®å½•  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. å®‰è£…ä¾èµ–      â”‚
â”‚    - brew æƒé™   â”‚
â”‚    - NodeJS     â”‚
â”‚    - OpenClaw   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. é…ç½®ç¯å¢ƒ      â”‚
â”‚    - openclaw   â”‚
â”‚    - å…±äº«å±‚     â”‚
â”‚    - Auth       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. é…ç½® LaunchDaemonâ”‚
â”‚    - plist ç”Ÿæˆ  â”‚
â”‚    - æƒé™è®¾ç½®    â”‚
â”‚    - åŠ è½½å¯åŠ¨    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. Telegram é…å¯¹  â”‚
â”‚    - è‡ªåŠ¨æ‰¹å‡†    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. éªŒè¯æµ‹è¯•      â”‚
â”‚    - è¿›ç¨‹æ£€æŸ¥    â”‚
â”‚    - ç«¯å£æ£€æŸ¥    â”‚
â”‚    - åŠŸèƒ½æµ‹è¯•    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. ç”ŸæˆæŠ¥å‘Š      â”‚
â”‚    - ç”¨æˆ·ä¿¡æ¯    â”‚
â”‚    - Gateway çŠ¶æ€â”‚
â”‚    - Bot ä¿¡æ¯    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
âœ… éƒ¨ç½²å®Œæˆ (30 min)
```

---

## ğŸ’» è„šæœ¬è®¾è®¡

### ä¸»éƒ¨ç½²è„šæœ¬ (deploy-agent)

```python
#!/usr/bin/env python3
"""
Agent è‡ªåŠ¨åŒ–éƒ¨ç½²å·¥å…·
æ”¯æŒ L1 (Profile) å’Œ L2 (ç‹¬ç«‹ç”¨æˆ·) ä¸¤ç§æ¨¡å¼
"""

import argparse
import sys
from lib.config import ConfigManager
from lib.deploy_l1 import L1Deployer
from lib.deploy_l2 import L2Deployer
from lib.verify import Verifier

def main():
    parser = argparse.ArgumentParser(description='OpenClaw Agent è‡ªåŠ¨åŒ–éƒ¨ç½²å·¥å…·')
    
    # éƒ¨ç½²æ¨¡å¼
    parser.add_argument('--mode', choices=['l1', 'l2'], required=True,
                       help='éƒ¨ç½²æ¨¡å¼ï¼šl1=Profile, l2=ç‹¬ç«‹ç”¨æˆ·')
    
    # Agent ä¿¡æ¯
    parser.add_argument('--name', required=True, help='Agent åç§°')
    parser.add_argument('--role', help='Agent è§’è‰²æè¿°')
    parser.add_argument('--bot-token', help='Telegram Bot Token')
    
    # L2 ç‰¹æœ‰
    parser.add_argument('--username', help='macOS ç”¨æˆ·å (L2 æ¨¡å¼)')
    parser.add_argument('--uid', type=int, help='ç”¨æˆ· ID (L2 æ¨¡å¼, è‡ªåŠ¨åˆ†é…)')
    parser.add_argument('--password', help='ç”¨æˆ·å¯†ç  (L2 æ¨¡å¼)')
    
    # é«˜çº§é€‰é¡¹
    parser.add_argument('--port', type=int, help='ç«¯å£å· (è‡ªåŠ¨åˆ†é…)')
    parser.add_argument('--dry-run', action='store_true', help='é¢„æ¼”æ¨¡å¼')
    parser.add_argument('--no-verify', action='store_true', help='è·³è¿‡éªŒè¯')
    parser.add_argument('--verbose', '-v', action='store_true', help='è¯¦ç»†è¾“å‡º')
    
    args = parser.parse_args()
    
    # é…ç½®ç®¡ç†
    config = ConfigManager()
    
    # é€‰æ‹©éƒ¨ç½²å™¨
    if args.mode == 'l1':
        deployer = L1Deployer(config, args)
    else:  # l2
        deployer = L2Deployer(config, args)
    
    # æ‰§è¡Œéƒ¨ç½²
    try:
        result = deployer.run()
        
        # éªŒè¯
        if result.success and not args.no_verify:
            verifier = Verifier(result)
            verifier.run()
        
        # è¾“å‡ºæŠ¥å‘Š
        print_report(result)
        
    except Exception as e:
        # å›æ»š
        deployer.rollback()
        print(f"âŒ éƒ¨ç½²å¤±è´¥ï¼š{e}", file=sys.stderr)
        sys.exit(1)

if __name__ == '__main__':
    main()
```

### L1 éƒ¨ç½²å™¨ (deploy_l1.py)

```python
class L1Deployer:
    """L1 Profile æ¨¡å¼éƒ¨ç½²å™¨"""
    
    def __init__(self, config, args):
        self.config = config
        self.args = args
        self.profile_name = args.name
        
    def run(self):
        """æ‰§è¡Œéƒ¨ç½²"""
        steps = [
            self.check_prerequisites,
            self.create_profile_dir,
            self.generate_config,
            self.setup_symlinks,
            self.start_gateway,
            self.pair_telegram,
        ]
        
        for step in steps:
            step()
            
        return DeployResult(success=True, mode='l1', profile=self.profile_name)
    
    def check_prerequisites(self):
        """æ£€æŸ¥å‰ç½®æ¡ä»¶"""
        # æ£€æŸ¥ OpenClaw æ˜¯å¦å®‰è£…
        # æ£€æŸ¥ç«¯å£æ˜¯å¦å ç”¨
        # æ£€æŸ¥ Bot Token æ˜¯å¦æœ‰æ•ˆ
        
    def create_profile_dir(self):
        """åˆ›å»º Profile ç›®å½•"""
        # ~/.openclaw-<profile>/
        
    def generate_config(self):
        """ç”Ÿæˆé…ç½®æ–‡ä»¶"""
        # ä½¿ç”¨ Jinja2 æ¨¡æ¿
        
    def setup_symlinks(self):
        """é…ç½®å…±äº«å±‚ symlink"""
        # skills, protocols, knowledge
        
    def start_gateway(self):
        """å¯åŠ¨ Gateway"""
        # openclaw gateway
        
    def pair_telegram(self):
        """Telegram é…å¯¹"""
        # è‡ªåŠ¨è·å–é…å¯¹ç å¹¶æ‰¹å‡†
```

### L2 éƒ¨ç½²å™¨ (deploy_l2.py)

```python
class L2Deployer:
    """L2 ç‹¬ç«‹ç”¨æˆ·æ¨¡å¼éƒ¨ç½²å™¨"""
    
    def __init__(self, config, args):
        self.config = config
        self.args = args
        self.username = args.username
        
    def run(self):
        """æ‰§è¡Œéƒ¨ç½²"""
        steps = [
            self.check_prerequisites,
            self.create_user,
            self.install_dependencies,
            self.configure_environment,
            self.setup_launchdaemon,
            self.start_gateway,
            self.pair_telegram,
        ]
        
        for step in steps:
            step()
            
        return DeployResult(success=True, mode='l2', username=self.username)
    
    def create_user(self):
        """åˆ›å»º macOS ç”¨æˆ·"""
        # dscl å‘½ä»¤
        
    def install_dependencies(self):
        """å®‰è£…ä¾èµ–"""
        # brew, node, openclaw
        
    def configure_environment(self):
        """é…ç½®ç¯å¢ƒ"""
        # openclaw.json, symlink, auth
        
    def setup_launchdaemon(self):
        """é…ç½® LaunchDaemon"""
        # plist ç”Ÿæˆå’ŒåŠ è½½
```

---

## ğŸ”§ é…ç½®æ¨¡æ¿

### openclaw.json.j2

```jinja2
{
  "meta": {
    "lastTouchedVersion": "2026.2.26",
    "agent": "{{ agent_name }}"
  },
  "env": {
    "DASHSCOPE_API_KEY": "{{ dashscope_key }}"
  },
  "gateway": {
    "port": {{ port }}
  },
  "channels": {
    "telegram": {
      "enabled": true,
      "botToken": "{{ bot_token }}"
    }
  },
  "agents": {
    "defaults": {
      "model": {
        "primary": "{{ default_model }}"
      }
    }
  }
}
```

### launchdaemon.plist.j2

```jinja2
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>Label</key>
    <string>ai.openclaw.{{ username }}.gateway</string>
    <key>ProgramArguments</key>
    <array>
        <string>/opt/homebrew/bin/openclaw</string>
        <string>gateway</string>
        <string>--port</string>
        <string>{{ port }}</string>
    </array>
    <key>WorkingDirectory</key>
    <string>/Users/{{ username }}</string>
    <key>RunAtLoad</key>
    <true/>
    <key>KeepAlive</key>
    <true/>
    <key>UserName</key>
    <string>{{ username }}</string>
</dict>
</plist>
```

---

## ğŸ“Š ç«¯å£å’Œ UID åˆ†é…

### ports.yaml

```yaml
# ç«¯å£åˆ†é…è¡¨
allocated:
  - port: 18789
    agent: claw
    mode: l1
  - port: 19001
    agent: sage
    mode: l1
  - port: 19002
    agent: shuaishuai
    mode: l2

next_available:
  l1: 19003
  l2: 19004

reserved:
  - 18788  # ä¿ç•™
  - 19000  # ä¿ç•™
```

### UID åˆ†é…

```yaml
# UID åˆ†é…è¡¨
allocated:
  - uid: 501
    username: xiafybot
  - uid: 502
    username: shuaishuai

next_available: 503

reserved:
  - 0-100    # ç³»ç»Ÿ
  - 200-300  # ä¿ç•™
```

---

## âœ… éªŒè¯ç³»ç»Ÿ

### éªŒè¯é¡¹ç›®

| æ£€æŸ¥é¡¹ | æ–¹æ³• | é¢„æœŸ |
|-------|------|------|
| è¿›ç¨‹è¿è¡Œ | `ps aux \| grep openclaw` | æœ‰è¿›ç¨‹ |
| ç«¯å£ç›‘å¬ | `lsof -i :<port>` | LISTEN |
| WebSocket | `ws://localhost:<port>` | å¯è¿æ¥ |
| Telegram | å‘é€ `/start` | Bot å›å¤ |
| æ¨¡å‹ | å‘é€æµ‹è¯•é—®é¢˜ | æ­£å¸¸å›ç­” |
| å·¥ä½œæµç¨‹ | "ä½ çš„å·¥ä½œæµç¨‹" | å›ç­”å…­æ­¥æ³• |

### verify.py

```python
class Verifier:
    """éƒ¨ç½²éªŒè¯å™¨"""
    
    def __init__(self, deploy_result):
        self.result = deploy_result
        
    def run(self):
        """æ‰§è¡ŒéªŒè¯"""
        checks = [
            self.check_process,
            self.check_port,
            self.check_websocket,
            self.check_telegram,
            self.check_workflow,
        ]
        
        results = []
        for check in checks:
            result = check()
            results.append(result)
            
        return VerifyReport(results)
    
    def check_process(self):
        """æ£€æŸ¥è¿›ç¨‹"""
        # ps aux | grep openclaw
        
    def check_port(self):
        """æ£€æŸ¥ç«¯å£"""
        # lsof -i :<port>
        
    def check_telegram(self):
        """æ£€æŸ¥ Telegram"""
        # å‘é€ /start
```

---

## ğŸ”„ å›æ»šæœºåˆ¶

### rollback-agent

```bash
#!/bin/bash
# éƒ¨ç½²å›æ»šè„šæœ¬

set -e

AGENT_NAME=$1
MODE=$2

echo "ğŸ”„ å¼€å§‹å›æ»š $AGENT_NAME ($MODE)..."

if [ "$MODE" = "l2" ]; then
    # L2 å›æ»š
    echo "1. åœæ­¢ Gateway"
    launchctl bootout system/ai.openclaw.$AGENT_NAME.gateway
    
    echo "2. åˆ é™¤ LaunchDaemon"
    rm -f /Library/LaunchDaemons/ai.openclaw.$AGENT_NAME.gateway.plist
    
    echo "3. åˆ é™¤ç”¨æˆ· (å¯é€‰)"
    read -p "æ˜¯å¦åˆ é™¤ç”¨æˆ· $AGENT_NAME? [y/N] " -n 1 -r
    if [[ $REPLY =~ ^[Yy]$ ]]; then
        sudo dscl . -delete /Users/$AGENT_NAME
    fi
else
    # L1 å›æ»š
    echo "1. åœæ­¢ Gateway"
    # kill è¿›ç¨‹
    
    echo "2. åˆ é™¤ Profile ç›®å½•"
    rm -rf ~/.openclaw-$AGENT_NAME
fi

echo "âœ… å›æ»šå®Œæˆ"
```

---

## ğŸ“± ç”¨æˆ·ç•Œé¢

### CLI ä½¿ç”¨ç¤ºä¾‹

```bash
# L1 éƒ¨ç½² (äº¤äº’å¼)
./deploy-agent --mode l1 --name researcher --role "å•†ä¸šç ”ç©¶å‘˜"

# L1 éƒ¨ç½² (å…¨è‡ªåŠ¨)
./deploy-agent --mode l1 --name researcher --role "å•†ä¸šç ”ç©¶å‘˜" \
  --bot-token "123456:ABCdef..." --no-verify

# L2 éƒ¨ç½² (äº¤äº’å¼)
./deploy-agent --mode l2 --username wifey --role "å¤«äººåŠ©ç†"

# L2 éƒ¨ç½² (å…¨è‡ªåŠ¨)
./deploy-agent --mode l2 --username wifey --role "å¤«äººåŠ©ç†" \
  --bot-token "123456:ABCdef..." --password "wifey.2026"

# é¢„æ¼”æ¨¡å¼
./deploy-agent --mode l2 --username test --dry-run

# åˆ—å‡ºå·²éƒ¨ç½² Agent
./list-agents

# éªŒè¯éƒ¨ç½²
./verify-agent --name shuaishuai

# å›æ»š
./rollback-agent --name test --mode l2
```

### äº¤äº’å¼ç•Œé¢ (å¯é€‰)

```
ğŸ¦€ OpenClaw Agent éƒ¨ç½²å·¥å…· v1.0

éƒ¨ç½²æ¨¡å¼:
  1) L1 - Profile (å¿«é€Ÿï¼Œ5 min)
  2) L2 - ç‹¬ç«‹ç”¨æˆ· (å®Œæ•´ï¼Œ30 min)
  
é€‰æ‹© [1-2]: 1

Agent åç§°ï¼šresearcher
è§’è‰²æè¿°ï¼šå•†ä¸šç ”ç©¶å‘˜
Telegram Bot Token: 123456:ABCdef...

å‰ç½®æ¡ä»¶æ£€æŸ¥...
âœ… OpenClaw å·²å®‰è£…
âœ… ç«¯å£ 19003 å¯ç”¨
âœ… Bot Token æœ‰æ•ˆ

å¼€å§‹éƒ¨ç½²...
[1/6] åˆ›å»º Profile ç›®å½•... âœ…
[2/6] ç”Ÿæˆé…ç½®æ–‡ä»¶... âœ…
[3/6] é…ç½®å…±äº«å±‚... âœ…
[4/6] å¯åŠ¨ Gateway... âœ…
[5/6] Telegram é…å¯¹... âœ…
[6/6] éªŒè¯æµ‹è¯•... âœ…

âœ… éƒ¨ç½²å®Œæˆï¼

Bot: @researcher_bot
ç«¯å£ï¼š19003
è®¿é—®ï¼šhttps://t.me/researcher_bot
```

---

## ğŸ“ˆ å®æ–½è®¡åˆ’

### Phase 1: æ ¸å¿ƒåŠŸèƒ½ (æœ¬å‘¨)

- [ ] åˆ›å»ºç›®å½•ç»“æ„
- [ ] å®ç° L1 éƒ¨ç½²å™¨
- [ ] å®ç° L2 éƒ¨ç½²å™¨
- [ ] é…ç½®æ¨¡æ¿ (Jinja2)
- [ ] åŸºç¡€éªŒè¯ç³»ç»Ÿ

**é¢„è®¡**: 8-10 å°æ—¶

### Phase 2: å®Œå–„åŠŸèƒ½ (ä¸‹å‘¨)

- [ ] å›æ»šæœºåˆ¶
- [ ] ç«¯å£/UID è‡ªåŠ¨åˆ†é…
- [ ] è¯¦ç»†æ—¥å¿—
- [ ] é”™è¯¯å¤„ç†
- [ ] æ–‡æ¡£ç¼–å†™

**é¢„è®¡**: 6-8 å°æ—¶

### Phase 3: ä¼˜åŒ–ä½“éªŒ (å¯é€‰)

- [ ] äº¤äº’å¼ç•Œé¢
- [ ] Web UI (å¯é€‰)
- [ ] API æ¥å£ (å¯é€‰)
- [ ] æ‰¹é‡éƒ¨ç½²

**é¢„è®¡**: 10-15 å°æ—¶

---

## ğŸ¯ æˆåŠŸæ ‡å‡†

| æŒ‡æ ‡ | ç›®æ ‡ | æµ‹é‡æ–¹æ³• |
|------|------|---------|
| éƒ¨ç½²æ—¶é—´ (L1) | < 5 min | è®¡æ—¶æµ‹è¯• |
| éƒ¨ç½²æ—¶é—´ (L2) | < 30 min | è®¡æ—¶æµ‹è¯• |
| è‡ªåŠ¨åŒ–ç‡ | > 90% | æ‰‹åŠ¨æ­¥éª¤è®¡æ•° |
| æˆåŠŸç‡ | > 95% | éƒ¨ç½²æµ‹è¯• |
| å›æ»šæˆåŠŸç‡ | 100% | å›æ»šæµ‹è¯• |
| ç”¨æˆ·æ»¡æ„åº¦ | > 4.5/5 | ç”¨æˆ·åé¦ˆ |

---

## âš ï¸ é£é™©ä¸åº”å¯¹

| é£é™© | æ¦‚ç‡ | å½±å“ | åº”å¯¹ |
|------|------|------|------|
| sudo å¯†ç è¾“å…¥ | é«˜ | ä¸­ | äº¤äº’å¼æç¤º |
| brew æƒé™é—®é¢˜ | ä¸­ | é«˜ | è‡ªåŠ¨ä¿®å¤ |
| ç«¯å£å†²çª | ä½ | ä¸­ | è‡ªåŠ¨æ£€æµ‹ |
| Bot Token æ— æ•ˆ | ä¸­ | é«˜ | é¢„éªŒè¯ |
| LaunchDaemon å¤±è´¥ | ä½ | é«˜ | å›æ»šæœºåˆ¶ |

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `deploy-automation-guide.md` â€” ä½¿ç”¨æŒ‡å—
- `deploy-automation-api.md` â€” API æ–‡æ¡£
- `CHANGELOG.md` â€” å˜æ›´æ—¥å¿—

---

*æ–‡æ¡£è·¯å¾„ï¼š`~/Documents/claw-outputs/projects/agent-platform/docs/deploy-automation-design.md`*
*æœ€åæ›´æ–°ï¼š2026-02-27 19:30*
